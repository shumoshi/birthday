<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Zen+Kurenaido&display=swap" rel="stylesheet">
    <title>桃子生誕祭2DAYS - ミッション一覧</title>
    <style>
        /* ---中略--- すべて元のまま --- */
        /* ▼スタンプ演出アニメを追加 */
        @keyframes stampPop {
          0%   { transform: scale(1);}
          50%  { transform: scale(1.22);}
          100% { transform: scale(1);}
        }
        .mission-card.completed.stamp-pop {
          animation: stampPop 0.6s cubic-bezier(.6,1.7,.9,.8) 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ...中略... -->
        <div class="mission-grid" id="missionGrid">
            <!-- ミッションが動的に生成される -->
        </div>
        <button class="reset-button" onclick="resetAll()">🔄 リセット</button>
    </div>

    <!-- サウンド -->
    <audio id="bgm-audio" src="bgm.mp3" loop></audio>
    <audio id="clear-audio" src="clear.mp3"></audio>

    <script>
        let missions = [
            /* ---中略--- */
        ];
        let completed = JSON.parse(localStorage.getItem('completed') || '[]');

        function init() {
            // BGM初期化（iOS対策でクリック以降再生も自動セット）
            const bgm = document.getElementById('bgm-audio');
            if (bgm) {
                bgm.volume = 0.12;
                // ユーザー操作のタイミングでも再生セット
                document.body.addEventListener('click', ()=>{ if(bgm.paused) bgm.play().catch(()=>{}); }, { once: true });
                bgm.play().catch(()=>{});
            }

            checkParams();
            showMissions();
            showProgress();
            showPhotos();
        }

        function addCard(num, mission, done) {
            // ...元のまま...
        }

        function completeMission(num) {
            // クリア音＆スタンプ演出
            try {
                const audio = document.getElementById('clear-audio');
                audio.currentTime = 0;
                audio.play().catch(()=>{});
            } catch(e){}
            // スタンプ演出
            setTimeout(() => {
                const grid = document.getElementById('missionGrid');
                const cards = grid.querySelectorAll('.mission-card');
                cards.forEach(card => {
                    if (!card.classList.contains('completed')) {
                        card.classList.add('stamp-pop');
                        setTimeout(()=>{ card.classList.remove('stamp-pop'); }, 700);
                    }
                });
            }, 10);

            completed.push(num);
            localStorage.setItem('completed', JSON.stringify(completed));
            window.location.href = `draw.html?mission=${num}`;
        }

        // ---残りの関数は全部そのまま！---

        window.addEventListener('load', init);
    </script>
</body>
</html>
